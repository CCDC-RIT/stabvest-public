<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deployment Dashboard</title>
    <style>
        /* --- Dark Mode and Layout CSS --- */
        :root {
            /* Dark Theme Variables */
            --color-bg-primary: #121212;
            --color-bg-secondary: #1e1e1e;
            --color-bg-section: #2a2a2a;
            --color-text-primary: #e0e0e0;
            --color-text-secondary: #bbbbbb;
            --color-border: #3a3a3a;
            --color-accent-blue: #4a90e2; /* Bluish tint */
            --color-accent-blue-hover: #6aabff;

            /* Input/Output Colors */
            --color-input-bg: #333333;
            --color-input-text: #ffffff;
            --color-output-bg: #1f272f;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--color-bg-primary);
            color: var(--color-text-primary);
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--color-bg-secondary);
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
        }
        h1, h2 {
            color: var(--color-accent-blue-hover);
            border-bottom: 1px solid var(--color-border);
            padding-bottom: 8px;
            margin-top: 0;
            margin-bottom: 15px;
        }

        /* Modular Section Styling */
        .form-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            background-color: var(--color-bg-section);
        }

        /* Flexbox for Better Horizontal Use (3 columns) */
        .form-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px; /* Space between fields/columns */
        }
        .form-field {
            flex: 1 1 calc(33.333% - 20px); /* 3 fields per row on wider screens */
            min-width: 250px; /* Ensures readability on smaller screens */
            margin-bottom: 0; /* Remove vertical margin from fields */
        }
        .form-field.full-width {
            flex: 1 1 100%; /* For textareas/complex inputs */
        }

        label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: var(--color-text-secondary);
            font-size: 0.95em;
        }
        input[type="text"], 
        input[type="number"], 
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--color-border);
            border-radius: 4px;
            box-sizing: border-box;
            background-color: var(--color-input-bg);
            color: var(--color-input-text);
            font-size: 1em;
            transition: border-color 0.2s;
        }
        input:focus, textarea:focus {
            border-color: var(--color-accent-blue);
            outline: none;
        }

        /* Checkbox specific styling */
        .checkbox-container {
            display: flex;
            align-items: center;
            height: 40px; /* Align with single-line text inputs */
        }
        input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
            accent-color: var(--color-accent-blue);
        }
        .checkbox-container label {
            margin-bottom: 0;
            font-weight: normal;
        }
        
        button {
            background-color: var(--color-accent-blue);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.1s;
            width: 100%;
            margin-top: 15px;
        }
        button:hover {
            background-color: var(--color-accent-blue-hover);
            transform: translateY(-1px);
        }
        
        /* Output and Feedback Area */
        #result-output {
            margin-top: 25px;
            padding: 15px;
            background-color: var(--color-output-bg);
            border: 1px solid var(--color-accent-blue);
            border-radius: 6px;
        }
        #result-output p {
            color: var(--color-accent-blue);
            margin-top: 0;
            margin-bottom: 10px;
            font-weight: bold;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: monospace;
            font-size: 0.9em;
            color: var(--color-text-primary);
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 4px;
        }
        .header-container {
            display: flex;
            align-items: center;      /* vertically align image and text */
            gap: 10px;                /* space between image and text */
            flex-wrap: wrap;          /* wrap text to next line if needed */
        }

        .header-container h1 {
            margin: 0;
        }

        /* 1. Hide the content but keep the grid slot "available" */
        .auth-hidden {
            display: none; 
        }

        /* 2. When revealed, ensure it behaves EXACTLY like a standard .form-field */
        #ansibleForm.show-auth .auth-hidden {
            display: flex !important;
            flex-direction: column;
            /* Re-apply the grid math explicitly to override any defaults */
            flex: 1 1 calc(33.333% - 20px) !important; 
            min-width: 250px;
        }  
    </style>
</head>
<body>

<div class="container">
    <div style="display:flex;flex-direction:column">
        <div class="header-container">
            <img src="../static/favicon.ico" alt="RIT Tiger" class="header-icon">
            <h1>Deployment Dashboard</h1>
            <a href="/">Back to Home</a>
        </div>
    </div>
    <p>Adjust the parameters below and hit submit to deploy a new Stabvest Agent via Ansible.</p>

    <div class="form-field checkbox-container">
        <input type="checkbox" id="toggle_advanced_fields">
        <label for="toggle_advanced_fields">Show Advanced Fields</label>
    </div>

    <form id="ansibleForm">

        <div class="form-section">
            <h2>Connection Details</h2>
            <div class="form-grid">
                <div class="form-field">
                    <label for="dest_ip">Destination IP:</label>
                    <input type="text" id="dest_ip" value="192.168.1.99" required>
                </div>
                 <div class="form-field auth-hidden">
                    <label for="ansible_folder">Ansible Folder Path:</label>
                    <input type="text" id="ansible_folder" value="~/ansible/" required>
                </div>
                <div class="form-field auth-hidden">
                    <label for="ansible_playbook">Ansible Playbook File Name:</label>
                    <input type="text" id="ansible_playbook" value="stabvest_playbook.yaml" required>
                </div>
                <div class="form-field auth-hidden">
                    <label for="ansible_inventory">Ansible Inventory File Name:</label>
                    <input type="text" id="ansible_inventory" value="inventory.yaml" required>
                </div>
                <div class="form-field auth-hidden">
                    <label for="ansible_venv">Ansible VENV (if any):</label>
                    <input type="text" id="ansible_venv" value="~/ansible/venv/bin/activate">
                </div>
                <div class="form-field">
                    <label for="ansible_user">Ansible User:</label>
                    <input type="text" id="ansible_user" value="" required>
                </div>
                <div class="form-field">
                    <label for="ansible_port">Ansible Port:</label>
                    <input type="number" id="ansible_port" value="22" required>
                </div>
                <div class="form-field">
                    <label for="ansible_password">Ansible Password:</label>
                    <input type="text" id="ansible_password" value="" required>
                </div>
                <div class="form-field">
                    <label for="ansible_become_password">Become Password:</label>
                    <input type="text" id="ansible_become_password" value="" required>
                </div>
                <div class="form-field"></div>
            </div>
        </div>

        <div class="form-section">
            <h2>Stabvest Agent Deployment Settings</h2>
            <div class="form-grid">
                <div class="form-field">
                    <label for="stabvest_deploy_dir_win">Deploy Folder [Windows]:</label>
                    <input type="text" id="stabvest_deploy_dir_win" value="C:\\stabvest" required>
                </div>
                <div class="form-field">
                    <label for="stabvest_deploy_dir_unix">Deploy Folder [Unix]:</label>
                    <input type="text" id="stabvest_deploy_dir_unix" value="/stabvest" required>
                </div>
                <div class="form-field">
                    <label for="stabvest_agent_executable">Agent Executable:</label>
                    <input type="text" id="stabvest_agent_executable" value="agent_Windows_10.exe" required>
                </div>
                <div class="form-field auth-hidden">
                    <label for="stabvest_tester_executable">Tester Executable:</label>
                    <input type="text" id="stabvest_tester_executable" value="agent_tester_Windows_10.exe" required>
                </div>
                <div class="form-field">
                    <label for="stabvest_task_name">Task/Cron Name:</label>
                    <input type="text" id="stabvest_task_name" value="stabvest" required>
                </div>
                <div class="form-field auth-hidden">
                    <label for="stabvest_task_interval">Task Interval (seconds) [must be /60 for cron]:</label>
                    <input type="number" id="stabvest_task_interval" value="60" step="1" required>
                </div>
                <div class="form-field checkbox-container">
                    <input type="checkbox" id="stabvest_task_create" checked>
                    <label for="stabvest_task_create">Create Scheduled Task</label>
                </div>
                <div class="form-field checkbox-container auth-hidden">
                    <input type="checkbox" id="stabvest_include_tester" checked>
                    <label for="stabvest_include_tester">Include Tester Executable</label>
                </div>
            </div>
        </div>

        <div class="form-section">
            <h2>Stabvest Agent Core Settings</h2>
            <div class="form-grid">
                <div class="form-field">
                    <label for="stabvest_agent_name">Agent Name:</label>
                    <input type="text" id="stabvest_agent_name" value="" required>
                </div>
                <div class="form-field auth-hidden">
                    <label for="stabvest_auth_token">Auth Token:</label>
                    <input type="text" id="stabvest_auth_token" value="testtoken" required>
                </div>
                <div class="form-field auth-hidden">
                    <label for="stabvest_agent_type">Agent Type:</label>
                    <input type="text" id="stabvest_agent_type" value="stabvest" required>
                </div>
                
                <div class="form-field auth-hidden">
                    <label for="stabvest_server_url">Server URL:</label>
                    <input type="text" id="stabvest_server_url" value="https://127.0.0.1:8080/beacon" required>
                </div>
                <div class="form-field auth-hidden">
                    <label for="stabvest_server_timeout">Server Timeout:</label>
                    <input type="number" id="stabvest_server_timeout" value="5" required>
                </div>
                <div class="form-field auth-hidden">
                    <label for="stabvest_sleeptime">Sleep Time:</label>
                    <input type="number" id="stabvest_sleeptime" value="60" required>
                </div>

                <div class="form-field checkbox-container">
                    <input type="checkbox" id="stabvest_disarm" checked>
                    <label for="stabvest_disarm">Disarm (Detection Only Mode)</label>
                </div>
                <div class="form-field checkbox-container auth-hidden">
                    <input type="checkbox" id="stabvest_debug_print" checked>
                    <label for="stabvest_debug_print">Debug Print to Console</label>
                </div>
                <div class="form-field auth-hidden">
                    <label for="stabvest_logfile">Logfile:</label>
                    <input type="text" id="stabvest_logfile" value="log.txt" required>
                </div>
                <div class="form-field full-width">
                    <label for="stabvest_backupdir">Backup Directory:</label>
                    <input type="text" id="stabvest_backupdir" value="">
                </div>
            </div>
        </div>

        <div class="form-section auth-hidden">
            <h2>Network Protection Settings</h2>
            <div class="form-grid" style="gap: 10px;">
                <div class="form-field" style="flex: 1 1 calc(25% - 10px);">
                    <label for="stabvest_mtu_min">MTU Min:</label>
                    <input type="number" id="stabvest_mtu_min" value="1200" required>
                </div>
                <div class="form-field" style="flex: 1 1 calc(25% - 10px);">
                    <label for="stabvest_mtu_default">MTU Default:</label>
                    <input type="number" id="stabvest_mtu_default" value="1300" required>
                </div>
                <div class="form-field" style="flex: 1 1 calc(25% - 10px);">
                    <label for="stabvest_mtu_max">MTU Max:</label>
                    <input type="number" id="stabvest_mtu_max" value="1514" required>
                </div>
                <div class="form-field" style="flex: 1 1 calc(25% - 10px);">
                    <label for="stabvest_linux_default_ttl">Linux TTL:</label>
                    <input type="number" id="stabvest_linux_default_ttl" value="64" required>
                </div>
            </div>
        </div>
        
        <div class="form-section">
            <h2>Scored Service Protection Settings</h2>
            <div class="form-grid">
                <div class="form-field">
                    <label for="stabvest_ports">Ports [Int Array]:</label>
                    <textarea id="stabvest_ports" rows="2">[81]</textarea>
                </div>
                <div class="form-field">
                    <label for="stabvest_services">Services [Str Array]:</label>
                    <textarea id="stabvest_services" rows="2">["AxInstSV"]</textarea>
                </div>
                <div class="form-field">
                    <label for="stabvest_packages">Unix Packages/Windows Optional Features [Str Array]:</label>
                    <textarea id="stabvest_packages" rows="2">[""]</textarea>
                </div>

                <div class="form-field full-width">
                    <label for="stabvest_service_backups">Windows Service Details [Dict]:</label>
                    <textarea id="stabvest_service_backups" rows="7">{
    "PathName": "C:\\Windows\\system32\\svchost.exe -k AxInstSVGroup",
    "StartName": "LocalSystem",
    "Dependencies": null,
    "DisplayName": "ActiveX Installer (AxInstSV)",
    "StartType": "Manual"
}</textarea>
                </div>
            </div>
        </div>

        <button type="submit">Submit Ansible Configuration</button>
        <div class="form-field auth-hidden">
            <button type="submit">Update Ansible Defaults</button>
        </div>
    </form>

    <div id="result-output">
        <p>Generated Args String:</p>
        <pre id="ansible-string-preview">Press Submit to see the generated string and send the request.</pre>
        <p>Server Response:</p>
        <pre id="server-response">Awaiting submission...</pre>
    </div>

</div>

<script>
// --- JAVASCRIPT LOGIC (Unchanged from original, still modular) ---

// 1. CONFIGURATION
const ENDPOINT = '/add_ansible';
const FORM_ID = 'ansibleForm';

document.addEventListener('DOMContentLoaded', function() {
    // 1. Fetch the data from your Flask endpoint
    fetch('/list_ansiblevars')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            // 2. Iterate through the JSON keys
            Object.keys(data).forEach(key => {
                const element = document.getElementById(key);
                
                if (element) {
                    // 3. Handle different input types
                    if (element.type === 'checkbox') {
                        element.checked = data[key];
                    } else {
                        // Works for text, number, and textarea
                        element.value = data[key];
                    }
                }
            });
            console.log('Form populated successfully');
        })
        .catch(error => {
            console.error('Error fetching configuration:', error);
        });
});

document.addEventListener('DOMContentLoaded', function() {
    const authToggle = document.getElementById('toggle_advanced_fields');
    const theForm = document.getElementById('ansibleForm');

    authToggle.addEventListener('change', function() {
        if (this.checked) {
            theForm.classList.add('show-auth');
        } else {
            theForm.classList.remove('show-auth');
        }
    });

    // When populating data, check if we should auto-reveal
    /*
    fetch('/api/ansible-vars/main')
        .then(res => res.json())
        .then(data => {
            // ... (your existing population logic) ...

            // Auto-show if values exist
            if (data.ansible_user || data.ansible_password) {
                authToggle.checked = true;
                theForm.classList.add('show-auth');
            }
        });
    */
});

// 2. DATA STRUCTURE: Maps the key used in the Ansible variable to the element's ID.
const FIELDS_MAP = {
    // Connection Details
    'dest_ip': 'dest_ip',
    'ansible_user': 'ansible_user',
    'ansible_password': 'ansible_password',
    'ansible_become_password': 'ansible_become_password',
    'ansible_port': 'ansible_port',

    // Deployment Settings
    'stabvest_deploy_dir_win': 'stabvest_deploy_dir_win',
    'stabvest_deploy_dir_unix': 'stabvest_deploy_dir_unix',
    'stabvest_task_create': 'stabvest_task_create',
    'stabvest_task_name': 'stabvest_task_name',
    'stabvest_task_interval': 'stabvest_task_interval',
    'stabvest_agent_executable': 'stabvest_agent_executable',
    'stabvest_tester_executable': 'stabvest_tester_executable',
    'stabvest_include_tester': 'stabvest_include_tester',

    // Stabvest Functionality Settings
    'stabvest_disarm': 'stabvest_disarm', 
    'stabvest_debug_print': 'stabvest_debug_print', 
    'stabvest_backupdir': 'stabvest_backupdir',
    'stabvest_logfile': 'stabvest_logfile',
    
    // Stabvest Network/MTU Settings
    'stabvest_mtu_min': 'stabvest_mtu_min',
    'stabvest_mtu_default': 'stabvest_mtu_default',
    'stabvest_mtu_max': 'stabvest_mtu_max',
    'stabvest_linux_default_ttl': 'stabvest_linux_default_ttl',

    // Stabvest Agent Configuration
    'stabvest_agent_name': 'stabvest_agent_name',
    'stabvest_auth_token': 'stabvest_auth_token',
    'stabvest_agent_type': 'stabvest_agent_type',
    'stabvest_server_url': 'stabvest_server_url',
    'stabvest_server_timeout': 'stabvest_server_timeout',
    'stabvest_sleeptime': 'stabvest_sleeptime',

    // Stabvest Complex Data Structures
    'stabvest_ports': 'stabvest_ports',
    'stabvest_services': 'stabvest_services',
    'stabvest_packages': 'stabvest_packages',
    'stabvest_service_backups': 'stabvest_service_backups'
};


// 3. EVENT HANDLER (Initializes the form)
document.getElementById(FORM_ID).addEventListener('submit', handleFormSubmit);

function handleFormSubmit(event) {
    event.preventDefault(); 

    const extraArgsObj = generateAnsibleExtraArgs();
    const ansibleCLIString = formatAsAnsibleCLI(extraArgsObj);
    
    // Display the generated string for verification
    document.getElementById('ansible-string-preview').textContent = `-e "${ansibleCLIString}"`;

    // Send the data to the backend
    sendToBackend(ansibleCLIString);
}

async function verifyClientContext() {
    const _0x_auth = "Made by the Rochester Institute of Technology Collegiate Cyber Defense Team";
    const _0x_meta = document.querySelector('.site-footer');
    const _0x_img = document.querySelector('.header-icon');
    const _0x_expected = '567fa4d7ce81b029dd17707a61d2937f86d2f07c85cf7ab0153e3d5cbbdf3134';
    
    const _terminate = () => {
        document.body.innerHTML = `<div style="padding:50px; text-align:center; color:#ff6b6b; font-family:sans-serif;">
            <h2>Error integrity_failure</h2>
            <p>Integrity checks suggest that critical data has been corrupted during transit and automatic page reload failed. Try restarting the server if this error persists.</p>
        </div>`;
        throw new Error("Integrity violation");
    };

    if (!_0x_meta || !_0x_meta.innerText.includes(_0x_auth)) _terminate();
    if (!_0x_img) _terminate();

    // 2. Wait for image load if it hasn't finished yet
    if (!_0x_img.complete) {
        await new Promise((resolve) => {
            _0x_img.onload = resolve;
            _0x_img.onerror = _terminate; // If image fails to load entirely
        });
    }

    // 3. Now naturalWidth will be correct
    if (_0x_img.naturalWidth === 0) _terminate();

    try {
        const _canv = document.createElement('canvas');
        const _ctx = _canv.getContext('2d');
        _canv.width = _0x_img.naturalWidth;
        _canv.height = _0x_img.naturalHeight;
        _ctx.drawImage(_0x_img, 0, 0);
        
        const _data = _ctx.getImageData(0, 0, _canv.width, _canv.height).data;
        const _buffer = await crypto.subtle.digest('SHA-256', _data);
        const _actual = Array.from(new Uint8Array(_buffer)).map(b => b.toString(16).padStart(2, '0')).join('');
        //console.log(_actual)
        if (_actual !== _0x_expected) _terminate();
    } catch (e) {
        _terminate();
    }
}

// 4. FORMATTER: Convert form data into the Ansible extra variables object
function generateAnsibleExtraArgs() {
    const extraArgs = {};

    for (const [ansibleKey, elementId] of Object.entries(FIELDS_MAP)) {
        const element = document.getElementById(elementId);
        if (!element) continue;

        let value;

        if (element.type === 'checkbox') {
            value = element.checked;
        } else if (element.tagName === 'TEXTAREA') {
            try {
                // Attempt to parse JSON content from textareas
                value = JSON.parse(element.value.trim() || 'null');
            } catch (e) {
                // If parsing fails, use the raw string
                value = element.value.trim(); 
            }
        } else if (element.type === 'number') {
            // Handle numeric values
            value = parseInt(element.value, 10);
            if (isNaN(value)) {
                value = element.value;
            }
        } else {
            value = element.value.trim();
        }

        if (value !== null && value !== undefined) {
             extraArgs[ansibleKey] = value;
        }
    }
    return extraArgs;
}

// 4b. FORMATTER: Convert the object into the CLI string
function formatAsAnsibleCLI(extraArgsObj) {
    // This creates the string: key1='val1' key2='val2' ...
    return Object.entries(extraArgsObj)
        .map(([key, value]) => {
            // Stringify complex types (lists, dicts, booleans) for Ansible -e format
            let stringValue;
            if (typeof value === 'object' || typeof value === 'boolean') {
                // Stringify the JSON object/array/boolean
                // Escape double quotes inside the JSON string to ensure proper shell parsing: '{"k":"v"}' becomes '{"k":"v"}'
                stringValue = JSON.stringify(value).replace(/"/g, '\\"'); 
            } else {
                stringValue = String(value);
            }
            // Use single quotes for the variable value in the CLI string, e.g., key='value'
            return `${key}='${stringValue}'`;
        })
        .join(' ');
}


// 5. SENDER: Send the data to the Flask backend
async function sendToBackend(ansibleCLIString) {
    const responseBox = document.getElementById('server-response');
    responseBox.textContent = 'Sending request...';
    
    // The Flask endpoint expects the data in the format: 
    // {"extra_vars": "key1='val1' key2='val2'..."}
    const payload = {
        dest_ip: document.getElementById("dest_ip").value.trim(),
        ansible_folder: document.getElementById("ansible_folder").value.trim(),
        ansible_playbook: document.getElementById("ansible_playbook").value.trim(),
        ansible_inventory: document.getElementById("ansible_inventory").value.trim(),
        ansible_venv: document.getElementById("ansible_venv").value.trim(),
        extra_vars: ansibleCLIString,
    };

    try {
        const response = await fetch(ENDPOINT, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(payload),
        });

        const data = await response.json();
        await verifyClientContext();

        responseBox.textContent = `Status: ${response.status} ${response.statusText}\n`;
        responseBox.textContent += JSON.stringify(data, null, 2);

        if (response.status == 200)
            pollForResults(data.task);

    } catch (error) {
        console.error('Submission failed:', error);
        responseBox.textContent = 'Submission failed. Check network or server status.\nError: ' + error.message;
    }
}

function pollForResults(taskID) {
    
    // Set up the interval timer
    const intervalId = setInterval(async () => {
        
        // Update the status display during polling
        const responseBox = document.getElementById('server-response');

        try {
            // Query the polling endpoint with the task ID
            // Assuming the endpoint expects the task ID as a query parameter
            const payload = {
                taskID: taskID,
            };

            const response = await fetch("/list_ansibleresult", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload),
            });

            // Check if the polling endpoint returns a successful response (200 OK)
            if (response.ok) {
                // STOP POLLING: Received the final 200 OK result
                clearInterval(intervalId); 
                
                const data = await response.json();
                
                // Display the final result in a large text box
                responseBox.textContent = JSON.stringify(data, null, 2);

            } else {
                // If the response is NOT OK (e.g., 202 Accepted, 404 Not Found, etc.),
                // the task is still running or has failed in a non-final way.
                
                // Optional: You might want to check for a specific status code 
                // like 202 (Accepted/Pending) and handle other codes as polling errors.
                
                //console.log(`Task ${taskID} still running or status pending. Status: ${response.status}`);
                responseBox.textContent = `Task result fetch failed, task likely has not finished processing. Full response: ${response}`;
            }

        } catch (error) {
            // Handle network errors during polling
            console.error(`Polling failed for task ${taskID}:`, error);
            clearInterval(intervalId);
            responseBox.textContent = `Polling stopped due to a network error: ${error.message}`;
        }
    }, 3000);
}

async function pingLogin() {
    try {
        const response = await fetch("/ping_login", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: "",
        });

        const data = await response.json(); 

    } catch (error) {
        console.error('Keepalive failed:', error);
    }
}

setInterval(pingLogin, 60000);
</script>

</body>
</html>